(function(S,o,P,e,ae,p,u,m,R){"use strict";let j=new Set(["1c","4d","abnf","accesslog","ada","arduino","ino","armasm","arm","avrasm","actionscript","as","ass","ssa","alan","ansi","i","log","ln","angelscript","asc","apache","apacheconf","applescript","osascript","arcade","asciidoc","adoc","aspectj","autohotkey","autoit","awk","mawk","nawk","gawk","bash","sh","zsh","basic","bbcode","blade","bnf","brainfuck","bf","csharp","cs","c","h","cpp","hpp","cc","hh","c++","h++","cxx","hxx","cal","cos","cls","cmake","cmake.in","coq","csp","css","csv","capnproto","capnp","chaos","kaos","chapel","chpl","cisco","clojure","clj","coffeescript","coffee","cson","iced","cpc","crmsh","crm","pcmk","crystal","cr","cypher","d","dns","zone","bind","dos","bat","cmd","dart","delphi","dpr","dfm","pas","pascal","freepascal","lazarus","lpr","lfm","diff","patch","django","jinja","dockerfile","docker","dsconfig","dts","dust","dst","dylan","ebnf","elixir","ex","elm","erlang","erl","extempore","xtlang","xtm","fsharp","fs","fix","fortran","f90","f95","gcode","nc","gams","gms","gauss","gss","godot","gdscript","gherkin","gn","gni","go","golang","gf","golo","gololang","gradle","groovy","xml","html","xhtml","rss","atom","xjb","xsd","xsl","plist","svg","http","https","haml","handlebars","hbs","html.hbs","html.handlebars","haskell","hs","haxe","hx","hy","hylang","ini","toml","inform7","i7","irpf90","json","java","jsp","javascript","js","jsx","jolie","iol","ol","julia","julia-repl","kotlin","kt","tex","leaf","lean","lasso","ls","lassoscript","less","ldif","lisp","livecodeserver","livescript","lock","ls","lua","makefile","mk","mak","make","markdown","md","mkdown","mkd","mathematica","mma","wl","matlab","maxima","mel","mercury","mirc","mrc","mizar","mojolicious","monkey","moonscript","moon","n1ql","nsis","never","nginx","nginxconf","nim","nimrod","nix","ocl","ocaml","ml","objectivec","mm","objc","obj-c","obj-c++","objective-c++","glsl","openscad","scad","ruleslanguage","oxygene","pf","pf.conf","php","php3","php4","php5","php6","php7","parser3","perl","pl","pm","plaintext","txt","text","pony","pgsql","postgres","postgresql","powershell","ps","ps1","processing","prolog","properties","proto","protobuf","puppet","pp","python","py","gyp","profile","python-repl","pycon","k","kdb","qml","r","cshtml","razor","razor-cshtml","reasonml","re","redbol","rebol","red","red-system","rib","rsl","graph","instances","robot","rf","rpm-specfile","rpm","spec","rpm-spec","specfile","ruby","rb","gemspec","podspec","thor","irb","rust","rs","SAS","sas","scss","sql","p21","step","stp","scala","scheme","scilab","sci","shexc","shell","console","smali","smalltalk","st","sml","ml","solidity","sol","stan","stanfuncs","stata","iecst","scl","structured-text","stylus","styl","subunit","supercollider","sc","srt","svelte","swift","tcl","tk","terraform","tf","hcl","tap","thrift","tp","tsql","ttml","twig","craftcms","typescript","ts","tsx","unicorn-rails-log","vbnet","vb","vba","vbscript","vbs","vhdl","vala","verilog","v","vim","vtt","axapta","x++","x86asm","xl","tao","xquery","xpath","xq","yml","yaml","zephir","zep"]),b,y,{MessagesHandlers:_}=o.findByProps("MessagesHandlers"),f=new Map,B=new Map,w=Symbol("isPatchedSymbol");const z=Symbol("unpatchALL");function re(a,l){b||(b&&console.error("Tried to start the MessageHandlersPatcher when it's already started"),b=Object.getOwnPropertyDescriptor(_.prototype,"params").get,Object.defineProperty(_.prototype,"params",{configurable:!0,get(){return this&&function(n){if(!n[w])for(let[t,s]of(n[w]=!0,y=n,B))f.set(t,P.before(s[0],y,s[1])),B.delete(t)}(this),b.call(this)}}));let r=Symbol("patch");return y?f.set(r,P.before(a,y,l)):B.set(r,[a,l]),function(){return J(r)}}function J(a){if(a==z){for(let l of f.values())l();f.clear()}else B.has(a)?B.delete(a):f.has(a)?(f.get(a)(),f.delete(a)):console.error(`MessageHandlersPatcher.unpatch should be used like: unpatch(patch) or unpatch(UnpatchALL). ${String(a)} was given instead.`);f.size||(b||console.error("Can't unpatch MessageHandlers when it was never patched in the first place"),Object.defineProperty(_.prototype,"params",{configurable:!0,get:b}),y&&(y[w]=!1),y=void 0,b=void 0)}var ne={patch:re,unpatch:J,UnpatchALL:z};let{View:$,TouchableOpacity:G}=p.General,{FormIcon:le}=p.Forms,W=o.findByName("Svg",!1).default,M=o.findByName("Svg",!1).Path;const oe=function({color:a}){return e.React.createElement(W,{height:"24",width:"24",viewBox:"0 0 96 96",fill:a},e.React.createElement(M,{d:"M11 20a3 3 90 000 6h74a3 3 90 000-6zm0 26a3 3 90 000 6H76a10 10 90 010 20h-17.76l2.88-2.88a3 3 90 10-4.24-4.24l-8 8a3 3 90 000 4.24l8 8a3 3 90 104.24-4.24l-2.88-2.88H76a16 16 90 000-32z"}),e.React.createElement(M,{d:"M8 75a3 3 90 013-3h26a3 3 90 010 6h-26a3 3 90 01-3-3"}))},se=function({color:a}){return e.React.createElement(W,{height:"24",width:"24",viewBox:"0 0 32 32"},e.React.createElement(M,{d:"m3 16 9-9 2 2-7 7 7 7-2 2zm15 7 7-7-7-7 2-2 9 9-9 9z",fill:a}))},D=function({onPress:a,info:l,colors:r,active:n,content:t}){return e.React.createElement(G,{onPress:a,onLongPress:function(){m.showToast(l,u.getAssetIDByName("ic_information_filled_24px"))},style:{backgroundColor:n?r.background.active:r.background.inactive,padding:4,borderRadius:5,borderWidth:2,borderColor:n?r.border.active:r.border.inactive}},t)},ie=function({children:a}){return e.React.createElement($,{style:{padding:15,paddingBottom:0,display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"space-between"}},e.React.createElement($,{style:{display:"flex",flexDirection:"row",gap:8}},a))};let ce=e.ReactNative.NativeModules.MediaManager.downloadMediaAsset;const ue=function({url:a,saveText:l,failText:r,copyText:n}){return e.React.createElement(G,{onPress:function(){ce(a,0).then(function(t){t?m.showToast(l,u.getAssetIDByName("ic_selection_checked_24px")):m.showToast(r,u.getAssetIDByName("ic_close_circle"))})},onLongPress:function(){e.clipboard.setString(a),m.showToast(n,u.getAssetIDByName("toast_copy_link"))}},e.React.createElement(le,{source:u.getAssetIDByName("ic_download_24px"),style:{marginRight:8,marginLeft:-8,opacity:1}}))};let{View:V,TouchableOpacity:H}=p.General,{FormText:de,FormIcon:A}=p.Forms,q=function({icon:a,buttonColor:l,textColor:r,text:n,onPress:t}){return e.React.createElement(H,{style:{backgroundColor:l,borderRadius:5,padding:10,marginBottom:15,marginTop:5,flexDirection:"row",justifyContent:"space-between",alignItems:"center"},onPress:t},a,e.React.createElement(p.Forms.FormText,{style:{color:r,fontSize:16,fontFamily:e.constants.Fonts.PRIMARY_BOLD,textTransform:"uppercase"}},n),e.React.createElement(V,null))};function pe({onJumpToBottom:a,onJumpToTop:l,onClose:r,textColor:n,buttonColor:t,texts:s}){return e.React.createElement(e.React.Fragment,null,e.React.createElement(V,{style:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:15}},e.React.createElement(de,{style:{fontSize:20,fontFamily:e.constants.Fonts.PRIMARY_BOLD}},s.JUMP),e.React.createElement(H,{onPress:r},e.React.createElement(A,{source:u.getAssetIDByName("ic_close_16px"),style:{opacity:1}}))),e.React.createElement(q,{icon:e.React.createElement(A,{source:u.getAssetIDByName("ic_jump_to_bottom_24px"),style:{opacity:1}}),text:s.JUMP_BOTTOM,onPress:a,buttonColor:t,textColor:n}),e.React.createElement(q,{icon:e.React.createElement(A,{source:u.getAssetIDByName("ic_jump_to_bottom_24px"),style:{opacity:1,transform:[{scaleY:-1}]}}),text:s.JUMP_TOP,onPress:l,buttonColor:t,textColor:n}))}let{Text:Y,TouchableOpacity:fe}=p.General;const ge=function({filename:a,color:l,subtext:r,copyText:n}){return e.React.createElement(fe,{onPress:function(){e.clipboard.setString(a),m.showToast(n,u.getAssetIDByName("toast_copy_message"))}},e.React.createElement(Y,{numberOfLines:1,style:{color:l}},a),e.React.createElement(Y,{numberOfLines:1,style:{color:l,fontSize:12}},r))};let{Text:K,TouchableOpacity:he}=p.General;function be({buttonColor:a,textColor:l,buttonTextColor:r,remainingText:n,onPress:t,moreText:s}){return e.React.createElement(e.React.Fragment,null,e.React.createElement(K,{style:{color:l,marginTop:7}},n),e.React.createElement(he,{style:{backgroundColor:a,borderRadius:5,padding:10,marginBottom:20,marginTop:5},onPress:t},e.React.createElement(K,{style:{color:r,textTransform:"uppercase",fontWeight:"bold",textAlign:"center",fontSize:20}},s)))}const ye={PREVIEW:{"en-US":"Preview","en-GB":"Preview","zh-CN":"\u9884\u89C8","zh-TW":"\u9810\u89BD",cs:"N\xE1hled",da:"L\xE6s fil",nl:"Voorbeeld",fr:"Aper\xE7u",de:"Vorschau",el:"\u03B4\u03B9\u03B1\u03B2\u03AC\u03C3\u03B5\u03C4\u03B5","es-ES":"Leer",uk:"\u0447\u0438\u0442\u0430\u0442\u0438"},FILE_SAVED:{"en-US":"File saved","en-GB":"File saved","es-ES":"Archivo guardado",cs:"Soubor ulo\u017Een",uk:"\u0424\u0430\u0439\u043B \u0437\u0431\u0435\u0440\u0435\u0436\u0435\u043D\u043E"},FILE_SAVE_ERROR:{"en-US":"Error saving file","en-GB":"Error saving file","es-ES":"Error guardando archivo",cs:"Chyba p\u0159i \xFAkl\xE1d\xE1n\xED souboru",uk:"\u041F\u043E\u043C\u0438\u043B\u043A\u0430 \u0437\u0431\u0435\u0440\u0435\u0436\u0435\u043D\u043D\u044F \u0444\u0430\u0439\u043B\u0443"},TOGGLE_WORD_WRAP:{"en-US":"Toggle Word Wrap","en-GB":"Toggle Word Wrap","es-ES":"Salto de l\xEDnea",cs:"P\u0159epnout obt\xE9k\xE1n\xED slov",uk:"\u041F\u0435\u0440\u0435\u043C\u0438\u043A\u0430\u0447 \u0430\u0432\u0442\u043E\u043F\u0435\u0440\u0435\u043D\u043E\u0441\u0443 \u0441\u043B\u043E\u0432"},JUMP:{"en-US":"Jump"},JUMP_BOTTOM:{"en-US":"Jump to the bottom","en-GB":"Jump to the bottom","es-ES":"Saltar al final",cs:"Sko\u010Dit na konec",uk:"\u041F\u0440\u043E\u043A\u0440\u0443\u0442\u0456\u0442\u044C \u0434\u043E \u043D\u0438\u0437\u0443"},JUMP_TOP:{"en-US":"Jump to the top","en-GB":"Jump to the top","es-ES":"Saltar al principio",cs:"Sko\u010Dit na za\u010D\xE1tek",uk:"\u041F\u0440\u043E\u043A\u0440\u0443\u0442\u0456\u0442\u044C \u0434\u043E \u0432\u0435\u0440\u0445\u0443"},MONOSPACE:{"en-US":"Toggle Monospace Font","en-GB":"Toggle Monospace Font","es-ES":"Alternar fuente monoespaciada",cs:"P\u0159epnout pevn\xE9 p\xEDsmo",uk:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u0438 \u043C\u043E\u043D\u043E\u0448\u0438\u0440\u0438\u043D\u043D\u0438\u0439 \u0448\u0440\u0438\u0444\u0442"},COPIED:{"en-US":"Copied"},LOAD_MORE:{"en-US":"Load more"}};function me(a){return new Proxy(ye,{get:(l,r)=>l[r][a]??l[r]["en-US"]??Object.values(l[r])[0]})}let Ee=o.findByProps("intl").intl,v=o.findByStoreName("ThemeStore"),C=o.find(function(a){return a.default?.internal?.resolveSemanticColor})?.default.internal.resolveSemanticColor??o.find(function(a){return a.meta?.resolveSemanticColor})?.meta.resolveSemanticColor??function(){},xe=o.findByName("Navigator")??o.findByProps("Navigator")?.Navigator,Re=o.findByProps("getRenderCloseButton")?.getRenderCloseButton??o.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,{ActivityIndicator:Be,ScrollView:X,Image:ve,Modal:Ce}=e.ReactNative,{View:E,Text:Q}=p.General,Te=o.findByProps("useSafeAreaInsets"),ke=o.findByProps("intword"),Z=function(a){return ke.intword(a,["bytes","KB","MB","GB","TB","PB"],1024,void 0,void 0,void 0," ")},Se=o.findByProps("pushModal"),Pe={JUMP:pe},_e=function(){return e.React.createElement(E,{style:{margin:32}},e.React.createElement(Be,{size:"large"}))};const we=function({filename:a="unknown",url:l="",bytes:r=1}){let[n]=e.React.useState(function(){return me(Ee.currentLocale)}),t={header:C(v.theme,R.semanticColors.HEADER_PRIMARY),sub:C(v.theme,R.semanticColors.TEXT_MUTED),bgDark:C(v.theme,R.semanticColors.BACKGROUND_SECONDARY_ALT),bgBright:C(v.theme,R.semanticColors.BACKGROUND_SECONDARY),bgBrighter:C(v.theme,R.semanticColors.BACKGROUND_ACCENT)},s={background:{active:t.bgBrighter,inactive:t.bgDark},border:{active:t.bgBright,inactive:t.bgDark}},T=function(){let g=Te.useSafeAreaInsets(),[i,h]=e.React.useState(null),k=ae.storage.chunkSize||60928,[d,L]=e.React.useState({content:"",loadedBytes:k,firstTime:!0}),N=e.React.useRef(null),[F,Ue]=e.React.useState(!1),[I,je]=e.React.useState(!0),ze=!d.content;d.firstTime&&fetch(l,{headers:{Range:`bytes=0-${k}`}}).then(function(c){c.ok?c.text().then(function(x){L({content:x,loadedBytes:d.loadedBytes,firstTime:!1})}):L({content:"",loadedBytes:0,firstTime:!1})});let Je=i?Pe[i.key]:null;function $e(){h(null),N.current?.scrollTo?.({y:0,animated:!0})}function Ge(){h(null),N.current?.scrollToEnd?.({animated:!0})}let U=!1,We=0,[Ve,He]=e.React.useState([]);return ze?e.React.createElement(_e,null):e.React.createElement(E,{style:{marginTop:0}},e.React.createElement(ie,null,e.React.createElement(D,{onPress:function(){return Ue(function(c){return!c})},active:F,colors:s,info:n.TOGGLE_WORD_WRAP,content:e.React.createElement(oe,{color:F?t.header:t.sub})}),e.React.createElement(D,{onPress:function(){return je(function(c){return!c})},active:I,colors:s,info:n.MONOSPACE,content:e.React.createElement(se,{color:I?t.header:t.sub})}),e.React.createElement(D,{onPress:function(){return h({key:"JUMP",props:{onJumpToTop:$e,onJumpToBottom:Ge,onClose:function(){return h(null)},textColor:t.sub,buttonColor:t.bgBright,texts:{JUMP:n.JUMP,JUMP_BOTTOM:n.JUMP_BOTTOM,JUMP_TOP:n.JUMP_TOP}}})},active:!1,colors:s,info:"JUMP",content:e.React.createElement(ve,{source:u.getAssetIDByName("ic_arrow_right"),style:{height:24,width:24,transform:[{scaleX:-1},{rotate:"90deg"}]}})})),e.React.createElement(X,{ref:N,style:{margin:15,marginBottom:50+g.bottom}},e.React.createElement(X,{horizontal:!F},e.React.createElement(E,{style:{flexDirection:"row"}},e.React.createElement(E,{style:{borderTopLeftRadius:4,borderBottomLeftRadius:4,backgroundColor:t.bgDark,marginRight:5,paddingRight:2,paddingLeft:2,alignSelf:"flex-start"}},e.React.createElement(Q,{style:{textAlign:"right",color:t.sub,lineHeight:20}},Ve.map(function(c){return c?++We:" "}).join(`
`))),e.React.createElement(Q,{selectable:!0,style:[{color:t.header,lineHeight:20,flex:1},I&&{fontFamily:e.constants.Fonts.CODE_NORMAL}],onTextLayout:function(c){let x=c.nativeEvent.lines;He(x.map(function(qe,te){return!(te>0)||x[te-1].text.indexOf(`
`)>-1}))}},d.content))),d.loadedBytes<r&&e.React.createElement(be,{buttonColor:t.bgBright,buttonTextColor:t.header,textColor:t.sub,remainingText:`+ ${Z(r-d.loadedBytes)} not loaded.`,moreText:n.LOAD_MORE,onPress:function(){U||(U=!0,fetch(l,{headers:{Range:`bytes=${d.loadedBytes+1}-${d.loadedBytes+k}`}}).then(function(c){c.ok?c.text().then(function(x){L({content:d.content+x,loadedBytes:d.loadedBytes+k,firstTime:!1})}):(U=!1,m.showToast("Error: Network response was not ok",u.getAssetIDByName("ic_close_circle")))}))}})),e.React.createElement(Ce,{transparent:!0,animationType:"none",visible:i!=null,onRequestClose:function(){return h(null)}},e.React.createElement(E,{style:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.5)"}},e.React.createElement(E,{style:{backgroundColor:t.bgBrighter,padding:20,borderRadius:10,width:"90%"}},i!=null&&e.React.createElement(Je,i.props)))))};return e.React.createElement(xe,{initialRouteName:"FILE_CONTENT_PREVIEW",screens:{FILE_CONTENT_PREVIEW:{headerLeft:Re(function(){return Se.popModal("file-content-preview")}),headerRight:function(){return e.React.createElement(ue,{url:l,saveText:n.FILE_SAVED,failText:n.FILE_SAVE_ERROR,copyText:n.COPIED})},render:function(){return e.React.createElement(T,null)},headerTitle:function(){return e.React.createElement(ge,{filename:a,subtext:Z(r),color:t.header,copyText:n.COPIED})}}}})};let Me=o.findByStoreName("SelectedChannelStore"),ee=o.findByStoreName("MessageStore"),De=o.findByProps("pushModal");function Ae(){return ne.patch("handleTapInviteEmbed",function([{nativeEvent:a}]){let{index:l,messageId:r}=a,n=Me.getChannelId(),t=ee.getMessage(n,r);t.messageReference&&t.messageReference.type==0&&t.messageReference.channel_id!=n&&(t=ee.getMessage(t.messageReference.channel_id,t.messageReference.message_id)),t.messageSnapshots?.[0]?.message&&(t=t.messageSnapshots[0].message);let s=t.codedLinks,T=t.attachments.filter(function(g){return j.has(g.filename.toLowerCase().split(".").pop())});if(l>=s.length){let{filename:g,url:i,size:h}=T[l-s.length];console.log({filename:g,url:i,size:h}),De.pushModal({key:"file-content-preview",modal:{key:"file-content-preview",modal:we,props:{filename:g,url:i,bytes:h},animation:"slide-up",shouldPersistUnderModals:!1,closable:!0}})}})}let Oe=o.findByStoreName("ThemeStore"),Le=o.findByName("RowManager"),Ne=o.findByName("getEmbedThemeColors");function Fe(){return P.after("generate",Le.prototype,function(a,l){let{message:r}=l;if(!r||!r.attachments?.length)return;let n=[],t=[];r.attachments.forEach(function(s){j.has(s.filename.toLowerCase().split(".").pop())?n.push(function(T="unknown",g="? bytes"){let i;return{acceptLabelBackgroundColor:(i=Ne?.(Oe.theme)?.colors||{acceptLabelGreenBackgroundColor:-14385083,headerColor:-6973533,borderColor:268435455,backgroundColor:-14276817}).acceptLabelGreenBackgroundColor,headerColor:i.headerColor,borderColor:i.borderColor,backgroundColor:i.backgroundColor,thumbnailCornerRadius:15,headerText:"",titleText:"File \u2014 "+g,structurableSubtitleText:null,type:null,extendedType:3,participantAvatarUris:[],acceptLabelText:"Preview",splashUrl:null,noParticipantsText:`
`+T,ctaEnabled:!0}}(s.filename,s.size)):t.push(s)}),n.length&&(r.codedLinks?.length||(r.codedLinks=[]),r.codedLinks.push(...n),r.attachments=t)})}let O=[];var Ie={onLoad:function(){O.push(Ae()),O.push(Fe())},onUnload:function(){for(let a of O)a()}};return S.default=Ie,Object.defineProperty(S,"__esModule",{value:!0}),S})({},vendetta.metro,vendetta.patcher,vendetta.metro.common,vendetta.plugin,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui);
